<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- Basic Page Needs
  ================================================== -->
<meta charset="utf-8">
<title>Configure Snake</title>
<meta name="description" content="Configuration page for Tangled, a Pebble watchface">
<meta name="author" content="Nev Rawlins">
<!-- Mobile Specific Metas
  ================================================== -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

</head>
<body>

<!-- Primary Page Layout
	================================================== -->
<div class="container">
	<header>
		<h1>Configure Tangled</h1>
	</header>
	
	<div id="info" class="bg-info"  style="padding:4px">
   	<p>This configuration file is for Pebble watches that support color.</p>
		</div>

  <div id="bluetooth" data-role="fieldcontain" class="ui-bar ui-field-contain ui-body ui-br">
    <fieldset data-role="controlgroup"
                     data-type="horizontal" 
                     data-mini="true" 
                     class="ui-corner-all ui-controlgroup ui-controlgroup-horizontal ui-mini" 
                     aria-disabled="false" 
                     data-disabled="false" 
                     data-shadow="false" 
                     data-corners="true" 
                     data-exclude-invisible="true" 
                     data-init-selector=":jqmData(role=&#39;controlgroup&#39;)">
       <div role="heading" class="ui-controlgroup-label">
         <legend>Vibrate on BT disconnect</legend>
       </div>
       <div class="ui-controlgroup-controls">
        
         <div class="ui-radio">
          <input id="bluetooth1"
                  name="bluetooth" 
                  value="0" 
                  data-theme="" 
                  type="radio">
           <label for="bluetooth1" 
                  data-corners="true" 
                  data-shadow="false" 
                  data-iconshadow="true" 
                  data-wrapperels="span" 
                  data-icon="radio-off" 
                  data-theme="c" 
                  data-mini="true" 
                  class="ui-radio-off ui-btn ui-btn-up-c ui-btn-corner-all ui-mini ui-btn-icon-left ui-first-child">
             <span class="ui-btn-inner">
               <span class="ui-btn-text">Off</span>
               <span class="ui-icon ui-icon-radio-off ui-icon-shadow">&nbsp;</span>
             </span>
           </label>
         </div>
         <div class="ui-radio">
           <input id="bluetooth2" 
                  name="bluetooth" 
                  value="1" 
                  data-theme="" 
                  type="radio" 
                  checked="">
           <label for="bluetooth2" 
                  data-corners="true" 
                  data-shadow="false" 
                  data-iconshadow="true" 
                  data-wrapperels="span" 
                  data-icon="radio-on" 
                  data-theme="c" 
                  data-mini="true" 
                  class="ui-radio-on ui-btn-active ui-btn ui-btn-up-c ui-btn-corner-all ui-mini ui-btn-icon-left ui-last-child">
             <span class="ui-btn-inner">
               <span class="ui-btn-text">On</span>
               <span class="ui-icon ui-icon-radio-on ui-icon-shadow">&nbsp;</span>
             </span>
           </label>
         </div>
       </div>
     </fieldset>
   </div>

	<form id="config" role="form" class="input-lg" style="padding:10px">
		<fieldset style="padding:6px">
			<legend>Time</legend>
			<div class="radio">
			<label>
				<input type="radio" name="hour_24" value="off" checked>12-hour mode
				<input type="radio" name="hour_24" value="on">24-hour mode
			</label>
		</div>
  		</fieldset>
                <br>     
		<fieldset style="padding:6px">
			<legend>Choice of colors</legend>
			<div class="radio">
			<label>
				<input type="radio" name="colour" value="1" checked>Cyan<br>
				<input type="radio" name="colour" value="2">Green
			</label>
		</div>
  		</fieldset>
                <br>
		<fieldset style="padding:6px">
			<a href="pebblejs://close" class="btn btn-lg btn-default" role="button">Cancel</a>
				<button type="button" class="btn btn-lg btn-primary" id="b-submit">Save</button>
		</fieldset>
	</form>

	</div><!-- container -->

<!-- End Document
================================================== -->

	<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
	<script>
		var LATEST = "1.0";
		function saveOptions() {
			var params = {};
			$('#config').serializeArray().forEach(function(pair) {
				params[pair.name] = pair.value;
			});
			var options = {
				hour_24:	params.hour_24 === 'on',
				colour:		parseInt(params.colour)
			}
			return options;
		}
		function applyOptions() {
			var $form	= $('#config');
			var opts	= JSON.parse(getParam('options'));
			if (opts && opts.hour_24) {
				$form.find('[name="hour_24"]').prop('checked', true);
			}
			$form.find('[name="colour"]').prop('checked', true);
		}
		function getParam(key) {
			var params = window.location.hash;
			var val;
			params.replace(/(?:^|[#&])([a-z]+)=([^&]+)/ig, function(_, k, v) {
				if (key === k) {
					val = decodeURIComponent(v);
				}
			});
			return val;
		}
		function parseVersion(verStr) {
			var parts = verStr.split('.');
			return parts.reduce(function(sum, part) {
				return (sum * 1000) + parseInt(part, 10);
			}, 0);
		}
		// Something like this to get query variables.
		function getQueryParam(variable, default_) {
		    var query = window.location.search.substring(1);
		    var vars = query.split('&');
		    for (var i = 0; i < vars.length; i++) {
		        var pair = vars[i].split('=');
		        if (pair[0] == variable)
		            return decodeURIComponent(pair[1]);
		    }
		    return default_ || false;
		}
		$("#b-submit").click(function() {
			var return_to = getQueryParam('return_to', 'pebblejs://close#');
			document.location = return_to + encodeURIComponent(JSON.stringify(saveOptions()));
		});
		var version = getParam('v');
		if (!version || (parseVersion(version) < parseVersion(LATEST))) {
			$('#update-available').removeClass('hidden');
		}
		else {
			$('#up-to-date').removeClass('hidden');
		}
		applyOptions();
   </script>

</body>
</html>
